--// PuppyWare UI Library (Modernized)
--// Stage 1 + 2 Rewrite
--// Roblox API Safe | Leak Free | Same Visuals

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

--// Library
local Library = {
    Renders = {},
    Connections = {},
    Accent = Color3.fromRGB(255,120,30),
    Keybind = Enum.KeyCode.Z
}
Library.__index = Library

--// Utility
local Utility = {}

function Utility:Create(class, props)
    local obj = Instance.new(class)
    for k,v in pairs(props or {}) do
        obj[k] = v
    end
    table.insert(Library.Renders, obj)
    return obj
end

function Utility:Connect(signal, callback)
    local c = signal:Connect(callback)
    table.insert(Library.Connections, c)
    return c
end

function Utility:DisconnectAll()
    for _,c in ipairs(Library.Connections) do
        if c.Connected then
            c:Disconnect()
        end
    end
    table.clear(Library.Connections)
end

local function Tween(obj, props, t)
    TweenService:Create(
        obj,
        TweenInfo.new(t or 0.2, Enum.EasingStyle.Linear),
        props
    ):Play()
end

--// Window
function Library:CreateWindow()
    local Window = setmetatable({
        Pages = {},
        Open = true
    }, Library)

    -- ScreenGui
    local Gui = Utility:Create("ScreenGui", {
        Parent = PlayerGui,
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Global
    })

    -- Main Frame
    local Main = Utility:Create("Frame", {
        Parent = Gui,
        Size = UDim2.fromOffset(660,560),
        Position = UDim2.fromScale(0.5,0.5),
        AnchorPoint = Vector2.new(0.5,0.5),
        BackgroundColor3 = Color3.fromRGB(25,25,25),
        BorderColor3 = Color3.fromRGB(12,12,12)
    })

    -- Tabs
    local Tabs = Utility:Create("Frame", {
        Parent = Main,
        Size = UDim2.new(0,74,1,0),
        BackgroundColor3 = Color3.fromRGB(12,12,12)
    })

    local TabList = Utility:Create("UIListLayout", {
        Parent = Tabs,
        Padding = UDim.new(0,6),
        HorizontalAlignment = Enum.HorizontalAlignment.Center
    })

    -- Pages
    local PagesHolder = Utility:Create("Frame", {
        Parent = Main,
        Position = UDim2.new(0,74,0,0),
        Size = UDim2.new(1,-74,1,0),
        BackgroundColor3 = Color3.fromRGB(18,18,18)
    })

    Window.Gui = Gui
    Window.Tabs = Tabs
    Window.PagesHolder = PagesHolder

    -- Toggle UI
    Utility:Connect(UserInputService.InputBegan,function(input,gp)
        if gp then return end
        if input.KeyCode == Library.Keybind then
            Window.Open = not Window.Open
            Tween(Main,{BackgroundTransparency = Window.Open and 0 or 1},0.25)
        end
    end)

    function Window:Unload()
        Utility:DisconnectAll()
        Gui:Destroy()
    end

    return Window
end

--// Page
function Library:CreatePage(props)
    local Page = {
        Icon = props.Icon,
        Sections = {}
    }

    local Tab = Utility:Create("ImageButton", {
        Parent = self.Tabs,
        Size = UDim2.fromOffset(50,50),
        Image = Page.Icon,
        BackgroundTransparency = 1,
        ImageColor3 = Color3.fromRGB(120,120,120)
    })

    local Frame = Utility:Create("Frame", {
        Parent = self.PagesHolder,
        Size = UDim2.new(1,0,1,0),
        BackgroundTransparency = 1,
        Visible = false
    })

    Utility:Connect(Tab.MouseButton1Click,function()
        for _,p in pairs(self.Pages) do
            p.Frame.Visible = false
            p.Tab.ImageColor3 = Color3.fromRGB(120,120,120)
        end
        Frame.Visible = true
        Tab.ImageColor3 = Color3.new(1,1,1)
    end)

    Page.Tab = Tab
    Page.Frame = Frame
    table.insert(self.Pages, Page)

    if #self.Pages == 1 then
        Frame.Visible = true
        Tab.ImageColor3 = Color3.new(1,1,1)
    end

    function Page:CreateSection(props)
        local Section = {}

        local Holder = Utility:Create("Frame", {
            Parent = Frame,
            Size = UDim2.new(0.48,0,0,props.Size or 200),
            Position = props.Side == "Right" and UDim2.new(0.52,0,0,10) or UDim2.new(0,10,0,10),
            BackgroundColor3 = Color3.fromRGB(23,23,23),
            BorderColor3 = Color3.fromRGB(12,12,12)
        })

        local Title = Utility:Create("TextLabel", {
            Parent = Holder,
            Text = props.Name,
            Font = Enum.Font.Code,
            TextSize = 11,
            TextColor3 = Color3.fromRGB(205,205,205),
            BackgroundTransparency = 1,
            Position = UDim2.fromOffset(8,4),
            Size = UDim2.new(1,-16,0,16),
            TextXAlignment = Enum.TextXAlignment.Left
        })

        local Content = Utility:Create("UIListLayout", {
            Parent = Holder,
            Padding = UDim.new(0,6)
        })

        Content:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            Holder.Size = UDim2.new(Holder.Size.X.Scale,Holder.Size.X.Offset,0,Content.AbsoluteContentSize.Y+30)
        end)

        function Section:CreateToggle(opt)
            local State = opt.State or false

            local Btn = Utility:Create("TextButton",{
                Parent = Holder,
                Size = UDim2.new(1,-16,0,18),
                BackgroundTransparency = 1,
                Text = ""
            })

            local Box = Utility:Create("Frame",{
                Parent = Btn,
                Size = UDim2.fromOffset(10,10),
                Position = UDim2.fromOffset(0,4),
                BackgroundColor3 = State and Library.Accent or Color3.fromRGB(80,80,80)
            })

            local Label = Utility:Create("TextLabel",{
                Parent = Btn,
                Position = UDim2.fromOffset(18,0),
                Size = UDim2.new(1,-18,1,0),
                BackgroundTransparency = 1,
                Font = Enum.Font.Code,
                TextSize = 9,
                TextColor3 = Color3.fromRGB(205,205,205),
                TextXAlignment = Enum.TextXAlignment.Left,
                Text = opt.Name
            })

            Utility:Connect(Btn.MouseButton1Click,function()
                State = not State
                Tween(Box,{BackgroundColor3 = State and Library.Accent or Color3.fromRGB(80,80,80)},0.15)
                if opt.Callback then opt.Callback(State) end
            end)
        end

        return Section
    end

    return Page
end


local Library = loadstring(game:HttpGet("YOUR_URL"))()

local Window = Library:CreateWindow()
local Visuals = Window:CreatePage({Icon = "rbxassetid://8547254518"})

local ESP = Visuals:CreateSection({
    Name = "Player ESP",
    Size = 300,
    Side = "Left"
})

ESP:CreateToggle({
    Name = "Bounding Box",
    State = true,
    Callback = function(v)
        print("Bounding Box:", v)
    end
})

return Library
